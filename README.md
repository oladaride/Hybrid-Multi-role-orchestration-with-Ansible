# Hybrid-Multi-role-orchestration-with-Ansible
This repository contains a full Infrastructure as Code (IaC) and Configuration Management pipeline. It automates the provisioning of an AWS EC2 instance using Terraform and configures a Hybrid Environment (AWS + Local VM) with Ansible.

üõ†Ô∏è Phase 1: Provisioning (Terraform)
The AWS infrastructure was provisioned using Terraform to ensure a reproducible "Hardware" layer.
Provider: AWS
Resources: * aws_instance: Amazon Linux 2023 (t3.micro).
aws_security_group: Ingress opened for Port 22 (SSH) and Port 3306 (MySQL).
aws_key_pair: Linked to a local SSH identity (wsl-key).

‚öôÔ∏è Phase 2: Configuration (Ansible)
Once the nodes were reachable, Ansible orchestrated the software installation. The playboo<img width="1366" height="768" alt="Screenshot (1874)" src="https://github.com/user-attachments/assets/0e805ece-264e-4390-9d28-46ff93792717" />
<img width="1366" height="768" alt="Screenshot (1875)" src="https://github.com/user-attachments/assets/3179cce7-5d15-4762-a7ce-94e285b6e2d7" />
k w<img width="1366" height="768" alt="Screenshot (1876)" src="https://github.com/user-attachments/assets/8cb8d6ca-af3b-4123-a430-fd605ab78c48" />
<img width="1366" height="768" alt="Screenshot (1877)" src="https://github.com/user-attachments/assets/2ac5636a-1492-4e64-b35e-ae123fc833d1" />
as designed with Idempotency as a core principle.
Key Features:
Multi-OS Compatibility: Handles both dnf (RHEL-based) and apt (Debian-based) package managers in a single execution.
User Permission Automation: Automatically adds the ec2-user to the Docker group on AWS.
Security: Manages sudo privileges (become) across different authentication methods.

üöÄ Getting Started
1. Prerequisites
Terraform installed in WSL.

Ansible installed (sudo apt install ansible).

SSH keys generated (ssh-keygen -t rsa -b 4096).

2. Infrastructure Deployment
Bash
# Provision AWS Resources
`cd terraform_`
`terraform plan`
`terraform apply`

3. Configuration Management
Update your inventory with the IPs generated by Terraform and your local VM.
# Run the Playbook
`ansible-playbook -i inventory site.yml -K`
Event Handlers: Uses handlers to restart services only when configuration changes occur, minimizing downtime.

üìù Technical Lessons Learned

- SSH Identity and Authentication Initially, the connection to the AWS node failed due to a filename mismatch (.pem extension vs extensionless Linux keys).
- I resolved this by standardizing the ansible_ssh_private_key_file path in the inventory.
- For the local VM, I used ssh-copy-id to authorize my WSL public key for the custom user oladaride, enabling secure, key-based access.

- Cross-Platform Package Management Managing different Linux distributions required a modular approach. While Ubuntu uses the apt package manager, Amazon Linux 2023 uses dnf. Furthermore, Amazon Linux 2023 requires version-specific package names;
- I updated the playbook to call mariadb105-server specifically, as the generic mariadb-server alias is not available in its default repositories.

Handling Privilege Escalation A common "hang" in automation occurs when a remote host prompts for a sudo password. Since the AWS ec2-user is configured for passwordless sudo by default, but local Ubuntu is not;
- I implemented the '-K'(become password) flag in the Ansible execution command.

Network Bridging Connecting WSL2 to a local Virtual Machine required ensuring both were on a reachable subnet. I identified the VM's internal IP via ip addr show and verified the route from WSL, ensuring that the local firewall allowed inbound SSH traffic on Port 22.

üìä Final Execution Results
The project achieved a fully idempotent state. In the final run, Ansible verified that all services were already configured correctly, resulting in no unnecessary system changes.

Playbook Summary:
AWS EC2: Docker installed, MariaDB installed, ec2-user added to Docker group, services started and enabled.
Local VM: Apt cache updated, Nginx installed, service started and enabled.
